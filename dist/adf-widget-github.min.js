!function(t,i){"use strict";function a(t){var i={reload:!0,category:"GitHub",controllerAs:"vm",edit:{templateUrl:"{widgetsPath}/github/src/edit.html"}},a=angular.extend({resolve:{commits:["github","config",function(t,i){return i.path?t.getCommits(i):void 0}]}},i);t.widget("githubHistory",angular.extend({title:"Github History",description:"Display the commit history of a GitHub project as chart",controller:"GithubHistoryController",templateUrl:"{widgetsPath}/github/src/line-chart.html"},a)).widget("githubAuthor",angular.extend({title:"Github Author",description:"Displays the commits per author as pie chart",controller:"GithubAuthorController",templateUrl:"{widgetsPath}/github/src/pie-chart.html"},a)).widget("githubCommits",angular.extend({title:"Github Commits",description:"Displays the commits as list",controller:"GithubCommitsController",templateUrl:"{widgetsPath}/github/src/commits.html"},a)).widget("githubIssues",angular.extend({title:"Github Issues",description:"Displays issues as list of a GitHub project",controller:"GithubIssuesController",templateUrl:"{widgetsPath}/github/src/issues.html",resolve:{issues:function(t,i){return i.path?t.getIssues(i):void 0}}},i))}function e(t,i,a){function e(t){return l(r("issues",t))}function s(t){return l(r("commits",t))}function r(t,i){var e=a+i.path+"/"+t+"?callback=JSON_CALLBACK";return i.accessToken&&(e+="&access_token="+i.accessToken),e}function l(a){var e=t.defer();return i.jsonp(a).success(function(t){if(t&&t.meta){var i=t.meta.status;300>i?e.resolve(t.data):e.reject(t.data.message)}}).error(function(){e.reject()}),e.promise}var o={getCommits:s,getIssues:e};return o}function s(t,i){var a=this;a.issues=i}function r(t,i){function a(){var t={};angular.forEach(i,function(i){var a=i.commit.author.date;a=a.substring(0,a.indexOf("T")),t[a]?t[a]++:t[a]=1});var a=[],e={labels:[],data:[a],series:["Commits"],"class":"chart-line"};return angular.forEach(t,function(t,i){e.labels.push(i),a.push(t)}),e}var e=this;i&&(e.chart=a())}function l(t,i){var a=this;a.commits=i}function o(t,i){function a(){var t={};angular.forEach(i,function(i){var a=i.commit.author.name;t[a]?t[a]++:t[a]=1});var a={labels:[],data:[],series:["Commits"],"class":"chart-pie"};return angular.forEach(t,function(t,i){a.labels.push(i),a.data.push(t)}),a}var e=this;i&&(e.chart=a())}angular.module("adf.widget.github",["adf.provider","chart.js"]).value("githubApiUrl","https://api.github.com/repos/").config(a),a.$inject=["dashboardProvider"],angular.module("adf.widget.github").run(["$templateCache",function(t){t.put("{widgetsPath}/github/src/commits.html",'<div><div ng-if=!vm.commits class="alert alert-info">Please configure the widget</div><div ng-if=config.path><ul class=media-list><li class=media ng-repeat="commit in vm.commits"><div class=media-left><a href={{commit.author.html_url}} target=_blank><img class="media-object img-thumbnail" ng-src={{commit.author.avatar_url}} style="width: 64px; height: 64px;"></a></div><div class=media-body><h4 class=media-heading><a href={{commit.html_url}} target=_blank>{{commit.sha | limitTo: 12}}</a></h4><p>{{commit.commit.message | limitTo: 128}}</p><small><a href={{commit.author.html_url}} target=_blank>{{commit.commit.author.name}}</a>, {{commit.commit.author.date | date: \'yyyy-MM-dd HH:mm\'}}</small></div></li></ul></div></div>'),t.put("{widgetsPath}/github/src/edit.html",'<form role=form><div class=form-group><label for=path>Github Repository Path</label> <input type=text class=form-control id=path ng-model=config.path placeholder="Enter Path (username/reponame)"></div><div class=form-group><label for=path>Access Token</label> <input type=text class=form-control id=path ng-model=config.accessToken></div></form>'),t.put("{widgetsPath}/github/src/issues.html",'<div><div ng-if=!config.path class="alert alert-info">Please configure the widget</div><div ng-if=config.path><ul class=media-list><li class=media ng-repeat="issue in vm.issues"><div class=media-left><a href={{issue.user.html_url}} target=_blank><img class="media-object img-thumbnail" ng-src={{issue.user.avatar_url}} style="width: 64px; height: 64px;"></a></div><div class=media-body><h4 class=media-heading><a href={{issue.html_url}} target=_blank>#{{issue.number}} {{issue.title}}</a></h4><p>{{issue.body | limitTo: 128}}</p><small><a href={{issue.user.html_url}} target=_blank>{{issue.user.login}}</a>, {{issue.created_at | date: \'yyyy-MM-dd HH:mm\'}}</small></div></li></ul></div></div>'),t.put("{widgetsPath}/github/src/line-chart.html",'<div><div class="alert alert-info" ng-if=!vm.chart>Please insert a repository path in the widget configuration</div><div ng-if=vm.chart><canvas id=line class="chart chart-line" chart-data=vm.chart.data chart-labels=vm.chart.labels chart-series=vm.chart.series></canvas></div></div>'),t.put("{widgetsPath}/github/src/pie-chart.html",'<div><div class="alert alert-info" ng-if=!vm.chart>Please insert a repository path in the widget configuration</div><div ng-if=vm.chart><canvas id=pie class="chart chart-pie" chart-legend=true chart-data=vm.chart.data chart-labels=vm.chart.labels></canvas></div></div>')}]),angular.module("adf.widget.github").factory("github",e),e.$inject=["$q","$http","githubApiUrl"],angular.module("adf.widget.github").controller("GithubIssuesController",s),s.$inject=["config","issues"],angular.module("adf.widget.github").controller("GithubHistoryController",r),r.$inject=["config","commits"],angular.module("adf.widget.github").controller("GithubCommitsController",l),l.$inject=["config","commits"],angular.module("adf.widget.github").controller("GithubAuthorController",o),o.$inject=["config","commits"]}(window);