!function(){"use strict";function e(e){var t={reload:!0,category:"GitHub",controllerAs:"vm",edit:{templateUrl:"{widgetsPath}/github/src/edit.html"}},a=angular.extend({resolve:{commits:["github","config",function(e,t){return t.path?e.getCommits(t):void 0}]}},t);e.widget("githubHistory",angular.extend({title:"Github History",description:"Display the commit history of a GitHub project as chart",controller:"GithubHistoryController",templateUrl:"{widgetsPath}/github/src/line-chart.html"},a)).widget("githubAuthor",angular.extend({title:"Github Author",description:"Displays the commits per author as pie chart",controller:"GithubAuthorController",templateUrl:"{widgetsPath}/github/src/pie-chart.html"},a)).widget("githubCommits",angular.extend({title:"Github Commits",description:"Displays the commits as list",controller:"GithubCommitsController",templateUrl:"{widgetsPath}/github/src/commits.html"},a)).widget("githubIssues",angular.extend({title:"Github Issues",description:"Displays issues as list of a GitHub project",controller:"GithubIssuesController",templateUrl:"{widgetsPath}/github/src/issues.html",resolve:{issues:function(e,t){return t.path?e.getIssues(t):void 0}}},t)).widget("githubUserEvents",{title:"Github User Events",description:"Display events of a certain user.",category:"GitHub",controller:"GithubEventsController",controllerAs:"vm",templateUrl:"{widgetsPath}/github/src/events.user.html",reload:!0,edit:{templateUrl:"{widgetsPath}/github/src/events.user.edit.html"},resolve:{events:["github","config",function(e,t){return t.user?e.getUserEvents(t):void 0}]}}).widget("githubOrganisationEvents",{title:"Github Organisation Events",description:"Display events of a public organisation.",category:"GitHub",controller:"GithubEventsController",controllerAs:"vm",templateUrl:"{widgetsPath}/github/src/events.org.html",reload:!0,edit:{templateUrl:"{widgetsPath}/github/src/events.org.edit.html"},resolve:{events:["github","config",function(e,t){return t.org?e.getOrgaEvents(t):void 0}]}}).widget("githubRepoEvents",{title:"Github Repository Events",description:"Display events of a certain repository.",category:"GitHub",controller:"GithubEventsController",controllerAs:"vm",templateUrl:"{widgetsPath}/github/src/events.repo.html",reload:!0,edit:{templateUrl:"{widgetsPath}/github/src/events.repo.edit.html"},resolve:{events:["github","config",function(e,t){return t.path?e.getRepoEvents(t):void 0}]}})}function t(e,t,a){function i(e){return d(c("issues",e))}function s(e){return d(c("commits",e))}function n(e){return d(u("events",e)).then(o)}function l(e){return d(g("events",e)).then(o)}function r(e){return d(c("events",e)).then(o)}function o(e){for(var t=0;t<e.length;t++){e[t].userImage=e[t].actor.avatar_url,e[t].userUrl="https://github.com/"+e[t].actor.login,e[t].repoName=e[t].repo.name,e[t].repoUrl="https://github.com/"+e[t].repo.name;var a=e[t].repo.name,i=e[t].repoUrl,s=e[t].type;if("PullRequestEvent"===s){var n=e[t].payload.number,l=e[t].payload.action;"closed"===l?(e[t].messageAction="closed pull request ",e[t].messageElementOne=a+"#"+n,e[t].linkElementOne=i+"/issues/"+n):"opened"===l&&(e[t].messageAction="opened pull request ",e[t].messageElementOne=a+"#"+n,e[t].linkElementOne=i+"/issues/"+n),e[t].payload.pull_request&&(e[t].comments=m(e[t].payload.pull_request.title))}else if("PushEvent"===s){if(e[t].messageAction="pushed to ",e[t].messageElementOne=e[t].payload.ref.substring(11),e[t].linkElementOne=i+"/tree/"+e[t].messageElementOne,e[t].messageElementTwo=a,e[t].linkElementTwo=i,e[t].payload.commits){for(var r=e[t].payload.commits.length,o=[],c=0;r>c;c++){var u=e[t].payload.commits[c].sha,g={id:u,link:i+"/commit/"+u,message:e[t].payload.commits[c].message};o.push(g)}e[t].comments=o}}else if("IssueCommentEvent"===s){var d=e[t].payload.issue.number;e[t].messageAction="commented on issue ",e[t].messageElementOne=a+"#"+d,e[t].linkElementOne=i+"/issues/"+d,e[t].payload.issue.pull_request&&(e[t].messageAction="commented on pull request "),e[t].payload.comment&&(e[t].comments=m(e[t].payload.comment.body))}else if("IssuesEvent"===s){var l=e[t].payload.action;"closed"===l?e[t].messageAction="closed issue ":"opened"===l&&(e[t].messageAction="opened issue ");var d=e[t].payload.issue.number;e[t].messageElementOne=a+"#"+d,e[t].linkElementOne=i+"/issues/"+d,e[t].payload.issue.title&&(e[t].comments=m(e[t].payload.issue.title))}else if("DeleteEvent"===s)e[t].messageAction="deleted "+e[t].payload.ref_type+" "+e[t].payload.ref+" at ",e[t].messageElementOne=a,e[t].linkElementOne=i;else if("ReleaseEvent"===s){var h=e[t].payload.release.name;if(e[t].messageAction="released ",e[t].messageElementOne=h,e[t].linkElementOne=i+"/releases/tag/"+h,e[t].messageElementTwo=a,e[t].linkElementTwo=i,e[t].payload.release.assets){for(var r=e[t].payload.release.assets.length,o=[],c=0;r>c;c++){var g={message:e[t].payload.release.assets[c].name};o.push(g)}e[t].comments=o}}}return e}function m(e){var t=[],a={message:e};return t.push(a),t}function c(e,t){var i=a+"repos/"+t.path+"/"+e+"?callback=JSON_CALLBACK";return t.accessToken&&(i+="&access_token="+t.accessToken),i}function u(e,t){var i=a+"users/"+t.user+"/"+e;return t.org&&(i+="/orgs/"+t.org),i+="?callback=JSON_CALLBACK",t.accessToken&&(i+="&access_token="+t.accessToken),i}function g(e,t){var i=a+"orgs/"+t.org+"/"+e+"?callback=JSON_CALLBACK";return t.accessToken&&(i+="&access_token="+t.accessToken),i}function d(a){var i=e.defer();return t.jsonp(a).success(function(e){if(e&&e.meta){var t=e.meta.status;300>t?i.resolve(e.data):i.reject(e.data.message)}}).error(function(){i.reject()}),i.promise}var h={getCommits:s,getIssues:i,getUserEvents:n,getOrgaEvents:l,getRepoEvents:r};return h}function a(e,t){var a=this;a.issues=t}function i(e,t,a){function i(){var t={},i=e("orderBy")(a,function(e){return e.commit.author.date});angular.forEach(i,function(e){var a=e.commit.author.date;a=a.substring(0,a.indexOf("T")),t[a]?t[a]++:t[a]=1});var s=[],n={labels:[],data:[s],series:["Commits"],"class":"chart-line"};return angular.forEach(t,function(e,t){n.labels.push(t),s.push(e)}),n}var s=this;a&&(s.chart=i())}function s(e,t){var a=this;a.events=t}function n(e,t){var a=this;a.commits=t}function l(e,t){function a(){var e={};angular.forEach(t,function(t){var a=t.commit.author.name;e[a]?e[a]++:e[a]=1});var a={labels:[],data:[],series:["Commits"],"class":"chart-pie"};return angular.forEach(e,function(e,t){a.labels.push(t),a.data.push(e)}),a}var i=this;t&&(i.chart=a())}angular.module("adf.widget.github",["adf.provider","chart.js"]).value("githubApiUrl","https://api.github.com/").config(e),e.$inject=["dashboardProvider"],angular.module("adf.widget.github").run(["$templateCache",function(e){e.put("{widgetsPath}/github/src/commits.html",'<div><div ng-if=!vm.commits class="alert alert-info">Please configure the widget</div><div ng-if=config.path><ul class=media-list><li class=media ng-repeat="commit in vm.commits"><div class=media-left><a href={{commit.author.html_url}} target=_blank><img class="media-object img-thumbnail" ng-src={{commit.author.avatar_url}} style="width: 64px; height: 64px;"></a></div><div class=media-body><h4 class=media-heading><a href={{commit.html_url}} target=_blank>{{commit.sha | limitTo: 12}}</a></h4><p>{{commit.commit.message | limitTo: 128}}</p><small><a href={{commit.author.html_url}} target=_blank>{{commit.commit.author.name}}</a>, {{commit.commit.author.date | date: \'yyyy-MM-dd HH:mm\'}}</small></div></li></ul></div></div>'),e.put("{widgetsPath}/github/src/edit.html",'<form role=form><div class=form-group><label for=path>Github Repository Path</label> <input type=text class=form-control id=path ng-model=config.path placeholder="Enter Path (username/reponame)"></div><div class=form-group><label for=path>Access Token</label> <input type=text class=form-control id=path ng-model=config.accessToken></div></form>'),e.put("{widgetsPath}/github/src/events.org.edit.html",'<form role=form><div class=form-group><label for=path>Organisation</label> <input type=text class=form-control id=path ng-model=config.org placeholder="Enter Organisation"></div><div class=form-group><label for=path>Access Token</label> <input type=text class=form-control id=path ng-model=config.accessToken></div></form>'),e.put("{widgetsPath}/github/src/events.org.html",'<div><div ng-if=!config.org class="alert alert-info">Please configure the widget</div><div ng-if=config.org><ul class=media-list><li class=media ng-repeat="event in vm.events"><div class=media-left><a href={{event.userUrl}} target=_blank><img class="media-object img-thumbnail" ng-src={{event.userImage}} style="width: 64px; height: 64px;"></a></div><div class=media-body><h4 class=media-heading><a href={{event.userUrl}} target=_blank>{{event.actor.login}}</a> <span>{{event.messageAction | limitTo: 128}} <a href={{event.linkElementOne}}>{{event.messageElementOne}}</a></span> <span ng-if=event.messageElementTwo>at <a href={{event.linkElementTwo}}>{{event.messageElementTwo}}</a></span></h4><p ng-if=event.comments ng-repeat="comment in event.comments | limitTo:2"><a ng-if=comment.link href={{comment.link}}>{{comment.id | limitTo: 7}}&nbsp;</a> <span>{{comment.message | limitTo: 128}}</span></p><small><a href={{event.userUrl}} target=_blank>{{event.actor.login}}</a>, {{event.created_at | date: \'yyyy-MM-dd HH:mm\'}}</small></div></li></ul></div></div>'),e.put("{widgetsPath}/github/src/events.repo.edit.html",'<form role=form><div class=form-group><label for=path>Github Repository Path</label> <input type=text class=form-control id=path ng-model=config.path placeholder="Enter Path (owner/reponame)"></div><div class=form-group><label for=path>Access Token</label> <input type=text class=form-control id=path ng-model=config.accessToken></div></form>'),e.put("{widgetsPath}/github/src/events.repo.html",'<div><div ng-if=!config.path class="alert alert-info">Please configure the widget</div><div ng-if=config.path><ul class=media-list><li class=media ng-repeat="event in vm.events"><div class=media-left><a href={{event.userUrl}} target=_blank><img class="media-object img-thumbnail" ng-src={{event.userImage}} style="width: 64px; height: 64px;"></a></div><div class=media-body><h4 class=media-heading><a href={{event.userUrl}} target=_blank>{{event.actor.login}}</a> <span>{{event.messageAction | limitTo: 128}}<a href={{event.linkElementOne}}>{{event.messageElementOne}}</a></span> <span ng-if=event.messageElementTwo>at <a href={{event.linkElementTwo}}>{{event.messageElementTwo}}</a></span></h4><p ng-if=event.comments ng-repeat="comment in event.comments | limitTo:2"><a ng-if=comment.link href={{comment.link}}>{{comment.id | limitTo: 7}}</a> <span>{{comment.message | limitTo: 128}}</span></p><small><a href={{event.userUrl}} target=_blank>{{event.actor.login}}</a>, {{event.created_at | date: \'yyyy-MM-dd HH:mm\'}}</small></div></li></ul></div></div>'),e.put("{widgetsPath}/github/src/events.user.edit.html",'<form role=form><div class=form-group><label for=path>User Name</label> <input type=text class=form-control id=path ng-model=config.user placeholder="Enter User (username)"></div><div class=form-group><label for=path>Organisation</label> <input type=text class=form-control id=path ng-model=config.org placeholder="(Optional) Enter Organisation"></div><div class=form-group><label for=path>Access Token</label> <input type=text class=form-control id=path ng-model=config.accessToken></div></form>'),e.put("{widgetsPath}/github/src/events.user.html",'<div><div ng-if=!config.user class="alert alert-info">Please configure the widget</div><div ng-if=config.user><ul class=media-list><li class=media ng-repeat="event in vm.events"><div class=media-left><a href={{event.userUrl}} target=_blank><img class="media-object img-thumbnail" ng-src={{event.userImage}} style="width: 64px; height: 64px;"></a></div><div class=media-body><h4 class=media-heading><a href={{event.userUrl}} target=_blank>{{event.actor.login}}</a> <span>{{event.messageAction | limitTo: 128}}<a href={{event.linkElementOne}}>{{event.messageElementOne}}</a></span> <span ng-if=event.messageElementTwo>at <a href={{event.linkElementTwo}}>{{event.messageElementTwo}}</a></span></h4><p ng-if=event.comments ng-repeat="comment in event.comments | limitTo:2"><a ng-if=comment.link href={{comment.link}}>{{comment.id | limitTo: 7}}</a> {{comment.message | limitTo: 128}}</p><small><a href={{event.userUrl}} target=_blank>{{event.actor.login}}</a>, {{event.created_at | date: \'yyyy-MM-dd HH:mm\'}}</small></div></li></ul></div></div>'),e.put("{widgetsPath}/github/src/issues.html",'<div><div ng-if=!config.path class="alert alert-info">Please configure the widget</div><div ng-if=config.path><ul class=media-list><li class=media ng-repeat="issue in vm.issues"><div class=media-left><a href={{issue.user.html_url}} target=_blank><img class="media-object img-thumbnail" ng-src={{issue.user.avatar_url}} style="width: 64px; height: 64px;"></a></div><div class=media-body><h4 class=media-heading><a href={{issue.html_url}} target=_blank>#{{issue.number}} {{issue.title}}</a></h4><p>{{issue.body | limitTo: 128}}</p><small><a href={{issue.user.html_url}} target=_blank>{{issue.user.login}}</a>, {{issue.created_at | date: \'yyyy-MM-dd HH:mm\'}}</small></div></li></ul></div></div>'),e.put("{widgetsPath}/github/src/line-chart.html",'<div><div class="alert alert-info" ng-if=!vm.chart>Please insert a repository path in the widget configuration</div><div ng-if=vm.chart><canvas id=line class="chart chart-line" chart-data=vm.chart.data chart-labels=vm.chart.labels chart-series=vm.chart.series></canvas></div></div>'),e.put("{widgetsPath}/github/src/pie-chart.html",'<div><div class="alert alert-info" ng-if=!vm.chart>Please insert a repository path in the widget configuration</div><div ng-if=vm.chart><canvas id=pie class="chart chart-pie" chart-legend=true chart-data=vm.chart.data chart-labels=vm.chart.labels></canvas></div></div>')}]),angular.module("adf.widget.github").factory("github",t),t.$inject=["$q","$http","githubApiUrl"],angular.module("adf.widget.github").controller("GithubIssuesController",a),a.$inject=["config","issues"],angular.module("adf.widget.github").controller("GithubHistoryController",i),i.$inject=["$filter","config","commits"],angular.module("adf.widget.github").controller("GithubEventsController",s),s.$inject=["config","events"],angular.module("adf.widget.github").controller("GithubCommitsController",n),n.$inject=["config","commits"],angular.module("adf.widget.github").controller("GithubAuthorController",l),l.$inject=["config","commits"]}(window);