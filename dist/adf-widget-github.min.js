!function(e,t){"use strict";function i(e){var t={reload:!0,category:"GitHub",controllerAs:"vm",edit:{templateUrl:"{widgetsPath}/github/src/edit.html"}},i=angular.extend({resolve:{commits:["github","config",function(e,t){if(t.path)return e.getCommits(t)}]}},t);e.widget("githubHistory",angular.extend({title:"GitHub History",description:"Displays the commit history of a GitHub project as chart",controller:"GithubHistoryController",templateUrl:"{widgetsPath}/github/src/line-chart.html"},i)).widget("githubAuthor",angular.extend({title:"GitHub Author",description:"Displays the commits per author as pie chart",controller:"GithubAuthorController",templateUrl:"{widgetsPath}/github/src/pie-chart.html"},i)).widget("githubCommits",angular.extend({title:"GitHub Commits",description:"Displays the commits of a GitHub project",controller:"GithubCommitsController",templateUrl:"{widgetsPath}/github/src/commits.html"},i)).widget("githubIssues",angular.extend({title:"GitHub Issues",description:"Displays the issues of a GitHub project",controller:"GithubIssuesController",templateUrl:"{widgetsPath}/github/src/issues.html",resolve:{issues:["github","config",function(e,t){if(t.path)return e.getIssues(t)}]}},t)).widget("githubUserEvents",{title:"GitHub User Events",description:"Displays events of a certain user",category:"GitHub",controller:"GithubEventsController",controllerAs:"vm",templateUrl:"{widgetsPath}/github/src/events.user.html",reload:!0,edit:{templateUrl:"{widgetsPath}/github/src/events.user.edit.html"},resolve:{events:["github","config",function(e,t){if(t.user)return e.getUserEvents(t)}]}}).widget("githubOrganisationEvents",{title:"GitHub Organisation Events",description:"Displays events of a public organisation",category:"GitHub",controller:"GithubEventsController",controllerAs:"vm",templateUrl:"{widgetsPath}/github/src/events.org.html",reload:!0,edit:{templateUrl:"{widgetsPath}/github/src/events.org.edit.html"},resolve:{events:["github","config",function(e,t){if(t.org)return e.getOrgaEvents(t)}]}}).widget("githubRepoEvents",{title:"GitHub Repository Events",description:"Displays events of a certain repository",category:"GitHub",controller:"GithubEventsController",controllerAs:"vm",templateUrl:"{widgetsPath}/github/src/events.repo.html",reload:!0,edit:{templateUrl:"{widgetsPath}/github/src/events.repo.edit.html"},resolve:{events:["github","config",function(e,t){if(t.path)return e.getRepoEvents(t)}]}})}function a(e,t,i){function a(e){return u(c("issues",e),e)}function s(e){return u(c("commits",e),e)}function n(e){return u(d("events",e),e).then(o)}function l(e){return u(g("events",e),e).then(o)}function r(e){return u(c("events",e),e).then(o)}function o(e){for(var t=0;t<e.length;t++){e[t].userImage=e[t].actor.avatar_url,e[t].userUrl="https://github.com/"+e[t].actor.login,e[t].repoName=e[t].repo.name,e[t].repoUrl="https://github.com/"+e[t].repo.name;var i=e[t].repo.name,a=e[t].repoUrl,s=e[t].type;if("PullRequestEvent"===s){var n=e[t].payload.number,l=e[t].payload.action;"closed"===l?(e[t].messageAction="closed pull request ",e[t].messageElementOne=i+"#"+n,e[t].linkElementOne=a+"/issues/"+n):"opened"===l&&(e[t].messageAction="opened pull request ",e[t].messageElementOne=i+"#"+n,e[t].linkElementOne=a+"/issues/"+n),e[t].payload.pull_request&&(e[t].comments=m(e[t].payload.pull_request.title))}else if("PushEvent"===s){if(e[t].messageAction="pushed to ",e[t].messageElementOne=e[t].payload.ref.substring(11),e[t].linkElementOne=a+"/tree/"+e[t].messageElementOne,e[t].messageElementTwo=i,e[t].linkElementTwo=a,e[t].payload.commits){for(var r=e[t].payload.commits.length,o=[],c=0;c<r;c++){var d=e[t].payload.commits[c].sha,g={id:d,link:a+"/commit/"+d,message:e[t].payload.commits[c].message};o.push(g)}e[t].comments=o}}else if("IssueCommentEvent"===s){var u=e[t].payload.issue.number;e[t].messageAction="commented on issue ",e[t].messageElementOne=i+"#"+u,e[t].linkElementOne=a+"/issues/"+u,e[t].payload.issue.pull_request&&(e[t].messageAction="commented on pull request "),e[t].payload.comment&&(e[t].comments=m(e[t].payload.comment.body))}else if("IssuesEvent"===s){var l=e[t].payload.action;"closed"===l?e[t].messageAction="closed issue ":"opened"===l&&(e[t].messageAction="opened issue ");var u=e[t].payload.issue.number;e[t].messageElementOne=i+"#"+u,e[t].linkElementOne=a+"/issues/"+u,e[t].payload.issue.title&&(e[t].comments=m(e[t].payload.issue.title))}else if("DeleteEvent"===s)e[t].messageAction="deleted "+e[t].payload.ref_type+" "+e[t].payload.ref+" at ",e[t].messageElementOne=i,e[t].linkElementOne=a;else if("ReleaseEvent"===s){var h=e[t].payload.release.name;if(e[t].messageAction="released ",e[t].messageElementOne=h,e[t].linkElementOne=a+"/releases/tag/"+h,e[t].messageElementTwo=i,e[t].linkElementTwo=a,e[t].payload.release.assets){for(var r=e[t].payload.release.assets.length,o=[],c=0;c<r;c++){var g={message:e[t].payload.release.assets[c].name};o.push(g)}e[t].comments=o}}}return e}function m(e){var t=[],i={message:e};return t.push(i),t}function c(e,t){return i+"repos/"+t.path+"/"+e}function d(e,t){var a=i+"users/"+t.user+"/"+e;return t.org&&(a+="/orgs/"+t.org),a}function g(e,t){var a=i+"orgs/"+t.org+"/"+e;return a}function u(i,a){var s=e.defer(),n={method:"GET",url:i,headers:{Authorization:"token "+a.accessToken}};return t.defaults.headers.get&&(delete t.defaults.headers.get["If-Modified-Since"],delete t.defaults.headers.get["Cache-Control"],delete t.defaults.headers.get.Pragma),t(n).success(function(e){s.resolve(e)}).error(function(e){s.reject()}),s.promise}var h={getCommits:s,getIssues:a,getUserEvents:n,getOrgaEvents:l,getRepoEvents:r};return h}function s(e,t){var i=this;i.issues=t}function n(e,t,i){function a(){var a={},s=e("orderBy")(i,function(e){return e.commit.author.date});angular.forEach(s,function(e){var t=e.commit.author.date;t=t.substring(0,t.indexOf("T")),a[t]?a[t]++:a[t]=1});var n=[],l={scales:{yAxes:[{id:"y-axis-1",display:!0,position:"left",ticks:{fixedStepSize:1},scaleLabel:{display:!0,labelString:"Commits"}}]},legend:{display:!0,position:"bottom"},responsive:!0},r={labels:[],data:[n],series:[t.path],"class":"chart-line",options:l};return angular.forEach(a,function(e,t){r.labels.push(t),n.push(e)}),r}var s=this;i&&(s.chart=a())}function l(e,t){var i=this;i.events=t}function r(e,t){var i=this;i.commits=t}function o(e,t){function i(){var e={};angular.forEach(t,function(t){var i=t.commit.author.name;e[i]?e[i]++:e[i]=1});var i={legend:{display:!0,position:"bottom"},responsive:!0},a={labels:[],data:[],series:["Commits"],"class":"chart-pie",options:i};return angular.forEach(e,function(e,t){a.labels.push(t),a.data.push(e)}),a}var a=this;t&&(a.chart=i())}i.$inject=["dashboardProvider"],a.$inject=["$q","$http","githubApiUrl"],s.$inject=["config","issues"],n.$inject=["$filter","config","commits"],l.$inject=["config","events"],r.$inject=["config","commits"],o.$inject=["config","commits"],angular.module("adf.widget.github",["adf.provider","chart.js"]).value("githubApiUrl","https://api.github.com/").config(i),angular.module("adf.widget.github").run(["$templateCache",function(e){e.put("{widgetsPath}/github/src/commits.html",'<div><div ng-if=!vm.commits class="alert alert-info">Please configure the widget</div><div ng-if=config.path><ul class=media-list><li class=media ng-repeat="commit in vm.commits"><div class=media-left><a href={{commit.author.html_url}} target=_blank><img class="media-object img-thumbnail" ng-src={{commit.author.avatar_url}} style="width: 64px; height: 64px;"></a></div><div class=media-body><h4 class=media-heading><a href={{commit.html_url}} target=_blank>{{commit.sha | limitTo: 12}}</a></h4><p>{{commit.commit.message | limitTo: 128}}</p><small><a href={{commit.author.html_url}} target=_blank>{{commit.commit.author.name}}</a>, {{commit.commit.author.date | date: \'yyyy-MM-dd HH:mm\'}}</small></div></li></ul></div></div>'),e.put("{widgetsPath}/github/src/edit.html",'<form role=form><div class=form-group><label for=path>Github Repository Path</label> <input type=text class=form-control id=path ng-model=config.path placeholder="Enter Path (username/reponame)"></div><div class=form-group><label for=path>Access Token</label> <input type=text class=form-control id=path ng-model=config.accessToken></div></form>'),e.put("{widgetsPath}/github/src/events.org.edit.html",'<form role=form><div class=form-group><label for=path>Organisation</label> <input type=text class=form-control id=path ng-model=config.org placeholder="Enter Organisation"></div><div class=form-group><label for=path>Access Token</label> <input type=text class=form-control id=path ng-model=config.accessToken></div></form>'),e.put("{widgetsPath}/github/src/events.org.html",'<div><div ng-if=!config.org class="alert alert-info">Please configure the widget</div><div ng-if=config.org><ul class=media-list><li class=media ng-repeat="event in vm.events"><div class=media-left><a href={{event.userUrl}} target=_blank><img class="media-object img-thumbnail" ng-src={{event.userImage}} style="width: 64px; height: 64px;"></a></div><div class=media-body><h4 class=media-heading><a href={{event.userUrl}} target=_blank>{{event.actor.login}}</a> <span>{{event.messageAction | limitTo: 128}} <a href={{event.linkElementOne}}>{{event.messageElementOne}}</a></span> <span ng-if=event.messageElementTwo>at <a href={{event.linkElementTwo}}>{{event.messageElementTwo}}</a></span></h4><p ng-if=event.comments ng-repeat="comment in event.comments | limitTo:2"><a ng-if=comment.link href={{comment.link}}>{{comment.id | limitTo: 7}}&nbsp;</a> <span>{{comment.message | limitTo: 128}}</span></p><small><a href={{event.userUrl}} target=_blank>{{event.actor.login}}</a>, {{event.created_at | date: \'yyyy-MM-dd HH:mm\'}}</small></div></li></ul></div></div>'),e.put("{widgetsPath}/github/src/events.repo.edit.html",'<form role=form><div class=form-group><label for=path>Github Repository Path</label> <input type=text class=form-control id=path ng-model=config.path placeholder="Enter Path (owner/reponame)"></div><div class=form-group><label for=path>Access Token</label> <input type=text class=form-control id=path ng-model=config.accessToken></div></form>'),e.put("{widgetsPath}/github/src/events.repo.html",'<div><div ng-if=!config.path class="alert alert-info">Please configure the widget</div><div ng-if=config.path><ul class=media-list><li class=media ng-repeat="event in vm.events"><div class=media-left><a href={{event.userUrl}} target=_blank><img class="media-object img-thumbnail" ng-src={{event.userImage}} style="width: 64px; height: 64px;"></a></div><div class=media-body><h4 class=media-heading><a href={{event.userUrl}} target=_blank>{{event.actor.login}}</a> <span>{{event.messageAction | limitTo: 128}}<a href={{event.linkElementOne}}>{{event.messageElementOne}}</a></span> <span ng-if=event.messageElementTwo>at <a href={{event.linkElementTwo}}>{{event.messageElementTwo}}</a></span></h4><p ng-if=event.comments ng-repeat="comment in event.comments | limitTo:2"><a ng-if=comment.link href={{comment.link}}>{{comment.id | limitTo: 7}}</a> <span>{{comment.message | limitTo: 128}}</span></p><small><a href={{event.userUrl}} target=_blank>{{event.actor.login}}</a>, {{event.created_at | date: \'yyyy-MM-dd HH:mm\'}}</small></div></li></ul></div></div>'),e.put("{widgetsPath}/github/src/events.user.edit.html",'<form role=form><div class=form-group><label for=path>User Name</label> <input type=text class=form-control id=path ng-model=config.user placeholder="Enter User (username)"></div><div class=form-group><label for=path>Organisation</label> <input type=text class=form-control id=path ng-model=config.org placeholder="(Optional) Enter Organisation"></div><div class=form-group><label for=path>Access Token</label> <input type=text class=form-control id=path ng-model=config.accessToken ng-required=config.org></div></form>'),e.put("{widgetsPath}/github/src/events.user.html",'<div><div ng-if=!config.user class="alert alert-info">Please configure the widget</div><div ng-if=config.user><ul class=media-list><li class=media ng-repeat="event in vm.events"><div class=media-left><a href={{event.userUrl}} target=_blank><img class="media-object img-thumbnail" ng-src={{event.userImage}} style="width: 64px; height: 64px;"></a></div><div class=media-body><h4 class=media-heading><a href={{event.userUrl}} target=_blank>{{event.actor.login}}</a> <span>{{event.messageAction | limitTo: 128}}<a href={{event.linkElementOne}}>{{event.messageElementOne}}</a></span> <span ng-if=event.messageElementTwo>at <a href={{event.linkElementTwo}}>{{event.messageElementTwo}}</a></span></h4><p ng-if=event.comments ng-repeat="comment in event.comments | limitTo:2"><a ng-if=comment.link href={{comment.link}}>{{comment.id | limitTo: 7}}</a> {{comment.message | limitTo: 128}}</p><small><a href={{event.userUrl}} target=_blank>{{event.actor.login}}</a>, {{event.created_at | date: \'yyyy-MM-dd HH:mm\'}}</small></div></li></ul></div></div>'),e.put("{widgetsPath}/github/src/issues.html",'<div><div ng-if=!config.path class="alert alert-info">Please configure the widget</div><div ng-if=config.path><ul class=media-list><li class=media ng-repeat="issue in vm.issues"><div class=media-left><a href={{issue.user.html_url}} target=_blank><img class="media-object img-thumbnail" ng-src={{issue.user.avatar_url}} style="width: 64px; height: 64px;"></a></div><div class=media-body><h4 class=media-heading><a href={{issue.html_url}} target=_blank>#{{issue.number}} {{issue.title}}</a></h4><p>{{issue.body | limitTo: 128}}</p><small><a href={{issue.user.html_url}} target=_blank>{{issue.user.login}}</a>, {{issue.created_at | date: \'yyyy-MM-dd HH:mm\'}}</small></div></li></ul></div></div>'),e.put("{widgetsPath}/github/src/line-chart.html",'<div><div class="alert alert-info" ng-if=!vm.chart>Please insert a repository path in the widget configuration</div><div ng-if=vm.chart><canvas id=line class="chart chart-line" chart-data=vm.chart.data chart-labels=vm.chart.labels chart-series=vm.chart.series chart-options=vm.chart.options></canvas></div></div>'),e.put("{widgetsPath}/github/src/pie-chart.html",'<div><div class="alert alert-info" ng-if=!vm.chart>Please insert a repository path in the widget configuration</div><div ng-if=vm.chart><canvas id=pie class="chart chart-pie" chart-legend=true chart-data=vm.chart.data chart-labels=vm.chart.labels chart-options=vm.chart.options></canvas></div></div>')}]),angular.module("adf.widget.github").factory("github",a),angular.module("adf.widget.github").controller("GithubIssuesController",s),angular.module("adf.widget.github").controller("GithubHistoryController",n),angular.module("adf.widget.github").controller("GithubEventsController",l),angular.module("adf.widget.github").controller("GithubCommitsController",r),angular.module("adf.widget.github").controller("GithubAuthorController",o)}(window);